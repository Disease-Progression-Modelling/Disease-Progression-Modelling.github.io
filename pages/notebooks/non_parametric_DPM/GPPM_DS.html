

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPPM with dynamical systems &#8212; Disease Progression Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_css.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/js/custom_js.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pages/notebooks/non_parametric_DPM/GPPM_DS';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Disease Course Sequencing and Phenotyping with the Subtype and Stage Inference Model" href="../sustain/sustain.html" />
    <link rel="prev" title="GPPM for disease progression modeling: basic use" href="GPPM_basic.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../main.html">
  
  
  
  
  
    <p class="title logo__title">Disease Progression Modelling</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../main.html">
                    Disease Progression Modelling
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../models/introduction.html">Introduction to DPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/event_based_model.html">Event Based Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/disease_course_mapping.html">Disease Course Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/non_parametric_DPM.html">GP Progression Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/SuStaIn.html">SuStaIn</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ebm/ebm.html">Disease Course Sequencing with the Event Based Model</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ebm/T1_kde_ebm_walkthrough.html">Tutorial 1 - EBM Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ebm/T2_pyEBM_walkthrough.html">Tutorial 2 - DEBM Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../disease_course_mapping/disease_course_mapping.html">Disease Course Mapping with Leaspy</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../disease_course_mapping/TP1_LMM.html">Tutorial 1 - Linear Mixed Effect Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disease_course_mapping/TP2_leaspy_beginner.html">Tutorial 2 - Get ready with Leaspy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disease_course_mapping/TP3_advanced_leaspy.html">Tutorial 3 - Leaspy advanced</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="non_parametric_DPM.html">GP Progression Model</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="GPPM_basic.html">Tutorial 1 - GP Progression Model Walkthrough</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tutorial 2 - GP Progression Model with Dynamical Systems Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sustain/sustain.html">Disease Course Sequencing and Phenotyping with the Subtype and Stage Inference Model</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../sustain/T1_sustain_walkthrough.html">Tutorial 1 - SuStaIn Walkthrough</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Conferences</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../conferences/conferences.html">Conferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conferences/MICCAI.html">MICCAI 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conferences/ISBI.html">ISBI 2021</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../other/contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/pages/notebooks/non_parametric_DPM/GPPM_DS.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/edit/master/pages/notebooks/non_parametric_DPM/GPPM_DS.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/issues/new?title=Issue%20on%20page%20%2Fpages/notebooks/non_parametric_DPM/GPPM_DS.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/pages/notebooks/non_parametric_DPM/GPPM_DS.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>GPPM with dynamical systems</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives :</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-i-introducing-the-framework">Part I: introducing the framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gppm-basic">GPPM-basic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gppm-ds">GPPM-DS</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example">An example</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#formally">Formally…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-ii-experimenting-with-different-dynamical-systems">Part II: experimenting with different dynamical systems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diffusion-data-with-different-connections-between-biomarkers">Diffusion data with different connections between biomarkers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-number-of-markers-propagation-parameters-etc">Changing number of markers, propagation parameters, etc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-the-dynamical-system">Changing the dynamical system</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iii-run-the-optimizer">Part III: run the optimizer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iv-application-to-amyloid-spread-on-adni-data">Part IV: application to amyloid spread on ADNI data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisation">Visualisation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#personalisation-of-disease-dynamics">Personalisation of disease dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-derive-two-animated-plots">We can derive two animated plots:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="gppm-with-dynamical-systems">
<h1>GPPM with dynamical systems<a class="headerlink" href="#gppm-with-dynamical-systems" title="Permalink to this heading">#</a></h1>
<p>This tutorial introduces the use of the software GPMM-DS available at https://gitlab.inria.fr/epione/GP_progression_model_V2.git&#64;feature/propagation_models</p>
<div class="section" id="objectives">
<h2>Objectives :<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Discover a framework for investigation of bio–mechanical hypotheses governing disease progression</p></li>
<li><p>Check out how you can model amyloid dynamics over the brain connectome in ADNI data</p></li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>git+https://gitlab.inria.fr/epione/GP_progression_model_V2.git@feature/propagation_models
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting git+https://gitlab.inria.fr/epione/GP_progression_model_V2.git@feature/propagation_models
  Cloning https://gitlab.inria.fr/epione/GP_progression_model_V2.git (to revision feature/propagation_models) to /tmp/pip-req-build-ps8og6u_
  Running command git clone -q https://gitlab.inria.fr/epione/GP_progression_model_V2.git /tmp/pip-req-build-ps8og6u_
  Running command git checkout -b feature/propagation_models --track origin/feature/propagation_models
  Switched to a new branch &#39;feature/propagation_models&#39;
  Branch &#39;feature/propagation_models&#39; set up to track remote branch &#39;feature/propagation_models&#39; from &#39;origin&#39;.
Building wheels for collected packages: gppm
  Building wheel for gppm (setup.py) ... ?25l?25hdone
  Created wheel for gppm: filename=gppm-2.0.0-cp37-none-any.whl size=24901 sha256=aabd9b3f5e62522d9c3527394fdcd3f0853818fbde5d7832059ff17d29d0679e
  Stored in directory: /tmp/pip-ephem-wheel-cache-5aiscnuw/wheels/8c/91/62/cecf21f30ab2cf21b105503711aa416a6f3acd40de119ac09f
Successfully built gppm
Installing collected packages: gppm
Successfully installed gppm-2.0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We now import what is needed to run this tutorial</span>

<span class="kn">import</span> <span class="nn">GP_progression_model</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="c1">#%matplotlib inline</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">platform</span> <span class="k">as</span> <span class="n">sys_pf</span>
<span class="k">if</span> <span class="n">sys_pf</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;TkAgg&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">GP_progression_model</span>
<span class="kn">from</span> <span class="nn">GP_progression_model</span> <span class="kn">import</span> <span class="n">DataGenerator</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">torch</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="part-i-introducing-the-framework">
<h2>Part I: introducing the framework<a class="headerlink" href="#part-i-introducing-the-framework" title="Permalink to this heading">#</a></h2>
<div class="section" id="gppm-basic">
<h3>GPPM-basic<a class="headerlink" href="#gppm-basic" title="Permalink to this heading">#</a></h3>
<p>In the previous session, we have learnt about the GPPM framework for estimating long term biomarker trajectories <span class="math notranslate nohighlight">\({\bf f}\)</span>, together with individual time-reparametrization parameters <span class="math notranslate nohighlight">\(\tau^s\)</span>, from short-term data <span class="math notranslate nohighlight">\({\bf Y}^s\)</span>:</p>
<div class="math notranslate nohighlight">
\[
 {\bf Y}^s(\tau^s) = {\bf f}(\tau^s) + {\boldsymbol \nu}^s(\tau^s) +\epsilon.
\]</div>
<p>Now, we know that we need to impose <strong>monotonicity constraints</strong> in order to identify the biomarker trajectories.</p>
</div>
<div class="section" id="gppm-ds">
<h3>GPPM-DS<a class="headerlink" href="#gppm-ds" title="Permalink to this heading">#</a></h3>
<p>But what if we use more complex constraints, for example requiring that the trajectories are constrained to some <strong>dynamical systems</strong> describing possible undergoing biological processes?</p>
<div class="section" id="an-example">
<h4>An example<a class="headerlink" href="#an-example" title="Permalink to this heading">#</a></h4>
<p>Let’s imagine a situation in which we have three biomarkers (it’s easier if we think of them as, for instance, amyloid in three different brain regions): A, B and C.</p>
<p><img alt="3biomarkers" src="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/_static/img/gppm/notebook-figs/note0.png?raw=true" /></p>
<p>We can then hypothesize the existence of different underlying biological processes that rule how the biomarkers’ values evolve over time.</p>
<p>For instance: all the biomarkers communicate with one-another, and so their values, over time, vary according to how much they receive/release to the other biomarkers.</p>
<p><img alt="3biomarkers-connected" src="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/_static/img/gppm/notebook-figs/note1.png?raw=true" /></p>
<p>Or just A and B could be interconnected:</p>
<p><img alt="3biomarkers-partiallyconnected" src="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/_static/img/gppm/notebook-figs/note2.png?raw=true" /></p>
<p>and so on.</p>
</div>
<div class="section" id="formally">
<h4>Formally…<a class="headerlink" href="#formally" title="Permalink to this heading">#</a></h4>
<p>We can formalise the existence of such processes through <strong>dynamical systems</strong> modelling:</p>
<div class="math notranslate nohighlight">
\[ {\bf{\dot{f}}}(t) = \mathcal{H}_{\boldsymbol\theta}(\bf{f}(t), t).\]</div>
<p>Here <span class="math notranslate nohighlight">\({\bf f}\)</span> represents the array of biomarkers <span class="math notranslate nohighlight">\((A, B, C)\)</span>, while <span class="math notranslate nohighlight">\(\mathcal{H}_{\boldsymbol\theta}\)</span> encodes the information regarding:</p>
<ul class="simple">
<li><p>the kind of process going on (i.e. the biomarkers simply diffuse over time? Or do they also plateau/saturate etc etc?)</p></li>
<li><p>the connections between biomarkers.</p></li>
</ul>
<p><em>Of course in a real-case scenario we do not know <span class="math notranslate nohighlight">\(\mathcal{H}_{\boldsymbol\theta}\)</span>, and instead we are interested in providing estimates of it!</em></p>
<p>Well, using the GPPM, we can set-up a <strong>combined framework</strong> to investigate the different bio–mechanical hypotheses governing disease progression.</p>
<p>In order to do so, we equip the standard GPPM model</p>
<div class="amsmath math notranslate nohighlight" id="equation-7ee96e33-e3bc-427f-b8f8-527513187bfb">
<span class="eqno">(1)<a class="headerlink" href="#equation-7ee96e33-e3bc-427f-b8f8-527513187bfb" title="Permalink to this equation">#</a></span>\[\begin{equation}
 {\bf Y}^s(\tau^s) = {\bf f}(\tau^s) + {\boldsymbol \nu}^s(\tau^s) +\epsilon,
\end{equation}\]</div>
<p>with (unknown) dynamical systems constraints on the biomarker trajectories</p>
<div class="amsmath math notranslate nohighlight" id="equation-36752760-1485-4fd7-882e-9e1175e5a405">
<span class="eqno">(2)<a class="headerlink" href="#equation-36752760-1485-4fd7-882e-9e1175e5a405" title="Permalink to this equation">#</a></span>\[\begin{equation}
{\bf\dot{f}}(t) = \mathcal{H}_{\boldsymbol\theta}({\bf f}(t), t).
\end{equation}\]</div>
<p><strong>The combined GPPM-DS framework provides spatio–temporal modeling and inference of biomarkers dynamics from short term data.</strong></p>
<p>This means we can estimate:</p>
<ul class="simple">
<li><p>long term biomarker trajectories <span class="math notranslate nohighlight">\({\bf f}\)</span>;</p></li>
<li><p>individual time-reparametrization parameters <span class="math notranslate nohighlight">\(g^s(\tau)\)</span>,</p></li>
<li><p>dynamical system parameters <span class="math notranslate nohighlight">\(\theta\)</span> (they depend on the chosen DS).</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="part-ii-experimenting-with-different-dynamical-systems">
<h2>Part II: experimenting with different dynamical systems<a class="headerlink" href="#part-ii-experimenting-with-different-dynamical-systems" title="Permalink to this heading">#</a></h2>
<div class="section" id="diffusion-data-with-different-connections-between-biomarkers">
<h3>Diffusion data with different connections between biomarkers<a class="headerlink" href="#diffusion-data-with-different-connections-between-biomarkers" title="Permalink to this heading">#</a></h3>
<p>Let’s check how the framework can be used to generate data with different underlying biological processes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Forward modelling.</span>

<span class="c1"># Definition of propagation model</span>

<span class="n">propagation_model</span> <span class="o">=</span> <span class="s2">&quot;diffusion&quot;</span> <span class="c1"># here we define which propagation model we use. Let&#39;s stick to &quot;diffusion&quot; for now</span>
</pre></div>
</div>
</div>
</div>
<p>Here we use the “diffusion” propagation model of equation
$<span class="math notranslate nohighlight">\({\bf\dot f}(t) = K_{{\bf\theta}_D}{\bf f}(t),\)</span><span class="math notranslate nohighlight">\(
where the matrix \)</span>K_{{\bf\theta}_D}$ encodes region–wise, constant rates of protein propagation across connected regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nbiom</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># number of biomarkers</span>
<span class="n">interval</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># lenght of the temporal interval</span>
<span class="n">Nsubs</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of subjects</span>

<span class="n">names_biomarkers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span><span class="o">+</span><span class="mi">1</span><span class="p">)]]</span>
<span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Numbers of parameters</span>
<span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span>

<span class="c1"># Let&#39;s define also the structure of connections. It can be seen as the adjaciency matrix of a graph</span>

<span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span> <span class="c1"># A &lt;-&gt; B &lt;-&gt; C</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span> <span class="c1"># A &lt;-&gt; B ; C</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;G1 adjaciency matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">G1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;G2 adjaciency matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f6049a52350&gt;
</pre></div>
</div>
<img alt="../../../_images/2a419835525d45b118651037e336018c74f6dcf308e0d7e58014fd7d94c44de1.png" src="../../../_images/2a419835525d45b118651037e336018c74f6dcf308e0d7e58014fd7d94c44de1.png" />
<img alt="../../../_images/9af4177ed81cd895d716cac4b18e08929736376e745d53ae5b24f1cdb8d7ae3d.png" src="../../../_images/9af4177ed81cd895d716cac4b18e08929736376e745d53ae5b24f1cdb8d7ae3d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta_kij</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span> <span class="c1">## Propagation parameters between regions</span>

<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">## x0 - initial point (baseline values)</span>

<span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Generate data 1 and plot </span>
<span class="n">theta1</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G1</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dg1</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">Nsubs</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dg1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 2, 3, 4, 5, 6, 7]
[5, 6, 7, 8, 9, 10, 11, 12]
[4, 5, 6, 7, 8, 9, 10, 11]
</pre></div>
</div>
<img alt="../../../_images/0270a8031297377ed73d519f74f8961daa8ba401a1f33600f6cc5797a4fef0f0.png" src="../../../_images/0270a8031297377ed73d519f74f8961daa8ba401a1f33600f6cc5797a4fef0f0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Generate data 2 and plot </span>
<span class="n">theta2</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G2</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dg2</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">Nsubs</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dg2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6, 7, 8, 9, 10, 11, 12, 13]
[1, 2, 3, 4, 5, 6, 7, 8]
[5, 6, 7, 8, 9, 10, 11, 12]
</pre></div>
</div>
<img alt="../../../_images/6e493f661cf945d810be049b1643f1c18dd28cfd54cd482d8264e847060bbcf0.png" src="../../../_images/6e493f661cf945d810be049b1643f1c18dd28cfd54cd482d8264e847060bbcf0.png" />
</div>
</div>
</div>
<div class="section" id="changing-number-of-markers-propagation-parameters-etc">
<h3>Changing number of markers, propagation parameters, etc<a class="headerlink" href="#changing-number-of-markers-propagation-parameters-etc" title="Permalink to this heading">#</a></h3>
<p>We can now play with the various parameters and see how the model behaves!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nbiom</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># number of biomarkers - you can change it HERE</span>
    
<span class="n">names_biomarkers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span><span class="o">+</span><span class="mi">1</span><span class="p">)]]</span>
<span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Numbers of parameters</span>
<span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span>

<span class="c1"># Generate random matrix G for diffusion between regions</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">GenerateConnectome</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">)</span>
<span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">GenerateConnectome</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">)</span>

<span class="c1">## Random propagation parameters between regions --&gt; try varying the interval to [0, .1] HERE</span>
<span class="n">theta_kij</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">)</span> 

<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">Nbiom</span><span class="p">,</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Random x0 - initial point (baseline values)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot the structure of the biomarkers&#39; connections (adjaciency matrix)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;G adjaciency matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f6049394750&gt;
</pre></div>
</div>
<img alt="../../../_images/fe944c128abc09d33f224c57b93bc8e7d1fb68d901b39c396b84eb042b653835.png" src="../../../_images/fe944c128abc09d33f224c57b93bc8e7d1fb68d901b39c396b84eb042b653835.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Generate the data </span>
<span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Nsubs</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">)</span>

<span class="c1">## And plot </span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 2, 3, 4, 5, 6, 7]
[3, 4, 5, 6, 7, 8, 9, 10]
[1, 2, 3, 4, 5, 6, 7, 8]
[4, 5, 6, 7, 8, 9, 10, 11]
[5, 6, 7, 8, 9, 10, 11, 12]
</pre></div>
</div>
<img alt="../../../_images/e9f087730e30003706de869a986505113184f4c558259279f6a4c704bcbcc810.png" src="../../../_images/e9f087730e30003706de869a986505113184f4c558259279f6a4c704bcbcc810.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## of course from here we can generate short-term data which are &#39;real&#39; data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5f2ab202aba71145aaa41e8e4bb674b73c70d0b38977b78925547c09a4ff4753.png" src="../../../_images/5f2ab202aba71145aaa41e8e4bb674b73c70d0b38977b78925547c09a4ff4753.png" />
</div>
</div>
</div>
<div class="section" id="changing-the-dynamical-system">
<h3>Changing the dynamical system<a class="headerlink" href="#changing-the-dynamical-system" title="Permalink to this heading">#</a></h3>
<p>We have different propagation models we can play with!</p>
<p>We have implemented the <strong>Reaction-diffusion (RD)</strong> model:</p>
<div class="math notranslate nohighlight">
\[{\bf \dot f}(t) = K_{{\theta}_{RD}} {\bf f}(t) + R_{{\theta}_{RD}}{\bf f}(t)({\upsilon} - {\bf f}(t)).\]</div>
<p>This model includes a propagation and an aggregation mechanism and is comprised of two terms: a diffusion term for constant protein propagation and a reaction term for protein aggregation. This term eventually reaches a plateau when protein concentration get to a maximal concentration threshold <span class="math notranslate nohighlight">\(\upsilon\)</span>.</p>
<p>And the <strong>Accumulation-Clearance-Propagation (ACP)</strong> model:</p>
<div class="math notranslate nohighlight">
\[{\bf\dot f}(t) 
  = K_{{\theta}_{ACP}}({\bf f},t) {\bf f}(t)+ R_{{\theta}_{ACP}}({\bf f},t){\bf f}(t)\]</div>
<p>The ACP model describes the three processes of accumulation, clearance and propagation of proteins allowing for non–constant effects.
The propagation term <span class="math notranslate nohighlight">\(K_{{\theta}_{ACP}}\)</span> is concentration–dependent: the toxic protein concentration in each region saturates when reaching a first critical threshold <span class="math notranslate nohighlight">\(\gamma=(\gamma_1,...,\gamma_N)\)</span>, and subsequently triggers propagation towards the connected regions. Propagation also reaches a plateaus when passing a second critical threshold <span class="math notranslate nohighlight">\(\eta=(\eta_1,...,\eta_N)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">######### We can now experiment with the three propagation models: try changing</span>
<span class="c1"># - propagation_model</span>
<span class="c1"># - Nbiom</span>
<span class="c1"># - the various thresholds/propagation parameters:</span>
<span class="c1">#         * diffusion: theta_kij</span>
<span class="c1">#         * RD: upsilon_main, theta_kij</span>
<span class="c1">#         * ACP: gamma_main, eta_main, theta_kij</span>


<span class="c1"># propagation_model = &quot;diffusion&quot;</span>
<span class="c1">#propagation_model = &quot;ACP&quot;</span>
<span class="n">propagation_model</span> <span class="o">=</span> <span class="s2">&quot;reaction-diffusion&quot;</span>

<span class="n">Nbiom</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">interval</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">Nsubs</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">names_biomarkers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]]</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">GenerateConnectome</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">)</span>
<span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">GenerateConnectome</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">)</span>

<span class="k">if</span> <span class="n">propagation_model</span> <span class="o">==</span> <span class="s2">&quot;ACP&quot;</span><span class="p">:</span>

    <span class="c1">## Numbers of parameters</span>
    <span class="n">N_thres_parameters</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Nbiom</span>
    <span class="n">N_kt_parameters</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span> <span class="o">+</span> <span class="n">N_kt_parameters</span> <span class="o">+</span> <span class="n">N_thres_parameters</span>

    <span class="n">gamma_main</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># Saturation and plateau regional thresholds: gamma and eta. Initialised as small variations around two main values</span>
    <span class="n">eta_main</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_main</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">eta_main</span> <span class="o">+</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">theta_kij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">N_kij_parameters</span><span class="p">)</span> <span class="c1"># Propagation parameters between regions</span>
    
    <span class="n">kt</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># Initial trigger</span>
  
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span><span class="p">,</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># x0 - initial point for generation</span>
    <span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">,</span> <span class="n">kt</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">propagation_model</span> <span class="o">==</span> <span class="s1">&#39;diffusion&#39;</span><span class="p">:</span>
    <span class="c1">## Numbers of parameters</span>
    <span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span>

    <span class="n">theta_kij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">)</span> <span class="c1"># Propagation parameters between regions</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span><span class="p">,</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># x0 - initial point for generation</span>
    <span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">propagation_model</span> <span class="o">==</span> <span class="s1">&#39;reaction-diffusion&#39;</span><span class="p">:</span>
    <span class="c1">## Numbers of parameters</span>
    <span class="n">N_thres_parameters</span> <span class="o">=</span> <span class="n">Nbiom</span>
    <span class="n">N_kt_parameters</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span> <span class="o">+</span> <span class="n">N_kt_parameters</span> <span class="o">+</span> <span class="n">N_thres_parameters</span>

    <span class="n">upsilon_main</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Plateau regional threshold: upsilon. Initialised as small variations around one main value</span>
    <span class="n">upsilon</span> <span class="o">=</span> <span class="n">upsilon_main</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span><span class="p">),</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">N_thres_parameters</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">theta_kij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">N_kij_parameters</span><span class="p">)</span> <span class="c1"># Propagation parameters between regions</span>

    <span class="n">kt</span> <span class="o">=</span> <span class="mf">.2</span> <span class="c1"># Total aggregation for the reaction term (which goes to plateau)</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upsilon_main</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Nbiom</span><span class="p">,</span> <span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># x0 - initial point for generation</span>
    <span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">,</span> <span class="n">kt</span><span class="p">,</span> <span class="n">upsilon</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">## Generate data</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Nsubs</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">)</span>

<span class="c1">## And plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32]
[3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]
[11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
</pre></div>
</div>
<img alt="../../../_images/543f9d277af2b02cd1fa00eb0ffe33d5d0862dd4d4842b2eff788e845eda2f7e.png" src="../../../_images/543f9d277af2b02cd1fa00eb0ffe33d5d0862dd4d4842b2eff788e845eda2f7e.png" />
</div>
</div>
</div>
</div>
<div class="section" id="part-iii-run-the-optimizer">
<h2>Part III: run the optimizer<a class="headerlink" href="#part-iii-run-the-optimizer" title="Permalink to this heading">#</a></h2>
<p>Let’s now actually run the optimiser!</p>
<p>Check how the framework performs in estimating</p>
<ul class="simple">
<li><p>biomarkers trajectories</p></li>
<li><p>propagation parameters</p></li>
</ul>
<p>from short–term data.</p>
<p>We go back to the <strong>3 biomarkers</strong> and <strong>diffusion model</strong> scenario.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">########### Generate data</span>
<span class="n">propagation_model</span> <span class="o">=</span> <span class="s2">&quot;diffusion&quot;</span> 

<span class="n">Nbiom</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">interval</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> 
<span class="n">Nsubs</span> <span class="o">=</span> <span class="mi">10</span> 
<span class="n">names_biomarkers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbiom</span><span class="o">+</span><span class="mi">1</span><span class="p">)]]</span>
<span class="n">N_kij_parameters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span> <span class="o">*</span> <span class="n">Nbiom</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> 
<span class="n">N_tot_parameters</span> <span class="o">=</span> <span class="n">N_kij_parameters</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span> <span class="c1"># A &lt;-&gt; B &lt;-&gt; C</span>

<span class="n">theta_kij</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span> 
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Data generation </span>
<span class="n">theta_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_kij</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_vec</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">N_tot_parameters</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">Nbiom</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Nsubs</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dg</span><span class="p">,</span> <span class="n">names_biomarkers</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">propagation_model</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">########### Optimization</span>

<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">fastest</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">GP_progression_model</span><span class="o">.</span><span class="n">GP_Progression_Model</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">ZeroXData</span><span class="p">,</span> <span class="n">dg</span><span class="o">.</span><span class="n">YData</span><span class="p">,</span> <span class="n">names_biomarkers</span> <span class="o">=</span> <span class="n">names_biomarkers</span><span class="p">,</span>
                                                      <span class="n">monotonicity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names_biomarkers</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">trade_off</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                                                      <span class="n">propagation_model</span> <span class="o">=</span> <span class="n">propagation_model</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">connectome</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span>
                                                      <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">Optimize</span><span class="p">(</span><span class="n">N_outer_iterations</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">N_tr_iterations</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">N_ode_iterations</span><span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">n_minibatch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
               <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization step: 1 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 14.40 - Cost (fit): 157.17 - Cost (constr): 442.81|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 16.58 - Cost (fit): 102.41 - Cost (constr): 158.71|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 19.20 - Cost (fit): 114.18 - Cost (constr): 211.48|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 19.17 - Cost (fit): 41.43 - Cost (constr): 9.05|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 18.74 - Cost (fit): 85.75 - Cost (constr): 17.25|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 18.74 - Cost (fit): 39.74 - Cost (constr): 67.72|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 18.74 - Cost (fit): 55.36 - Cost (constr): 76.03|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 18.74 - Cost (fit): 55.47 - Cost (constr): 17.39|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 18.74 - Cost (fit): 75.17 - Cost (constr): 93.23|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 18.74 - Cost (fit): 49.47 - Cost (constr): 15.11|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Optimization step: 2 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 18.75 - Cost (fit): 55.86 - Cost (constr): 32.06|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 19.06 - Cost (fit): 36.62 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 18.14 - Cost (fit): 63.35 - Cost (constr): 14.95|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 16.86 - Cost (fit): 16.96 - Cost (constr): 23.36|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 16.45 - Cost (fit): -0.42 - Cost (constr): 10.91|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 16.45 - Cost (fit): -2.25 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 16.45 - Cost (fit): 22.93 - Cost (constr): 15.86|| Batch (each iter) of size 10 || Time (each iter): 0.12s
Iteration 100 of 200 || Cost (DKL): 16.45 - Cost (fit): 13.78 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 16.45 - Cost (fit): -7.30 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 16.45 - Cost (fit): -5.51 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Optimization step: 3 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 16.43 - Cost (fit): 4.42 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 15.01 - Cost (fit): 8.10 - Cost (constr): 34.74|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 14.38 - Cost (fit): 9.69 - Cost (constr): 10.96|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 14.36 - Cost (fit): 8.72 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 14.17 - Cost (fit): -51.90 - Cost (constr): 34.34|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 14.17 - Cost (fit): -50.54 - Cost (constr): 9.29|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 14.17 - Cost (fit): -39.12 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 14.17 - Cost (fit): -48.53 - Cost (constr): 9.03|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 14.17 - Cost (fit): -47.80 - Cost (constr): 13.72|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 14.17 - Cost (fit): -36.25 - Cost (constr): 12.43|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Propagation parameters optimization -- 
Iteration 1 of 2000 || Cost (DKL): 14.17 - Cost (fit): -16.18 - Cost (constr): 15.45|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 2000 || Cost (DKL): 14.17 - Cost (fit): -45.20 - Cost (constr): 14.22|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 2000 || Cost (DKL): 14.17 - Cost (fit): -41.65 - Cost (constr): 14.72|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 150 of 2000 || Cost (DKL): 14.17 - Cost (fit): -18.69 - Cost (constr): 12.12|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 200 of 2000 || Cost (DKL): 14.17 - Cost (fit): -32.17 - Cost (constr): 11.39|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 250 of 2000 || Cost (DKL): 14.17 - Cost (fit): -48.93 - Cost (constr): 10.15|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 300 of 2000 || Cost (DKL): 14.17 - Cost (fit): -35.49 - Cost (constr): 11.58|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 350 of 2000 || Cost (DKL): 14.17 - Cost (fit): -39.64 - Cost (constr): 15.92|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 400 of 2000 || Cost (DKL): 14.17 - Cost (fit): -44.02 - Cost (constr): 17.16|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 450 of 2000 || Cost (DKL): 14.17 - Cost (fit): -56.36 - Cost (constr): 10.54|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 500 of 2000 || Cost (DKL): 14.17 - Cost (fit): -37.23 - Cost (constr): 10.12|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 550 of 2000 || Cost (DKL): 14.17 - Cost (fit): -38.01 - Cost (constr): 11.91|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 600 of 2000 || Cost (DKL): 14.17 - Cost (fit): -46.22 - Cost (constr): 10.67|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 650 of 2000 || Cost (DKL): 14.17 - Cost (fit): -51.99 - Cost (constr): 8.01|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 700 of 2000 || Cost (DKL): 14.17 - Cost (fit): -50.89 - Cost (constr): 9.94|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 750 of 2000 || Cost (DKL): 14.17 - Cost (fit): -34.37 - Cost (constr): 10.80|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 800 of 2000 || Cost (DKL): 14.17 - Cost (fit): -36.50 - Cost (constr): 11.17|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 850 of 2000 || Cost (DKL): 14.17 - Cost (fit): 8.47 - Cost (constr): 13.56|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 900 of 2000 || Cost (DKL): 14.17 - Cost (fit): -17.31 - Cost (constr): 8.70|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 950 of 2000 || Cost (DKL): 14.17 - Cost (fit): -53.20 - Cost (constr): 10.44|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1000 of 2000 || Cost (DKL): 14.17 - Cost (fit): -52.95 - Cost (constr): 9.51|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1050 of 2000 || Cost (DKL): 14.17 - Cost (fit): -46.87 - Cost (constr): 10.57|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1100 of 2000 || Cost (DKL): 14.17 - Cost (fit): -31.15 - Cost (constr): 9.99|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1150 of 2000 || Cost (DKL): 14.17 - Cost (fit): -54.30 - Cost (constr): 9.10|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1200 of 2000 || Cost (DKL): 14.17 - Cost (fit): -48.10 - Cost (constr): 10.71|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1250 of 2000 || Cost (DKL): 14.17 - Cost (fit): -55.65 - Cost (constr): 8.96|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1300 of 2000 || Cost (DKL): 14.17 - Cost (fit): -13.26 - Cost (constr): 9.53|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1350 of 2000 || Cost (DKL): 14.17 - Cost (fit): -33.53 - Cost (constr): 9.60|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1400 of 2000 || Cost (DKL): 14.17 - Cost (fit): -38.62 - Cost (constr): 11.11|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1450 of 2000 || Cost (DKL): 14.17 - Cost (fit): -58.16 - Cost (constr): 9.20|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1500 of 2000 || Cost (DKL): 14.17 - Cost (fit): -21.89 - Cost (constr): 9.05|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1550 of 2000 || Cost (DKL): 14.17 - Cost (fit): -44.40 - Cost (constr): 10.24|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1600 of 2000 || Cost (DKL): 14.17 - Cost (fit): 13.65 - Cost (constr): 8.39|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1650 of 2000 || Cost (DKL): 14.17 - Cost (fit): -31.80 - Cost (constr): 9.81|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1700 of 2000 || Cost (DKL): 14.17 - Cost (fit): -57.78 - Cost (constr): 8.94|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1750 of 2000 || Cost (DKL): 14.17 - Cost (fit): -46.39 - Cost (constr): 9.78|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1800 of 2000 || Cost (DKL): 14.17 - Cost (fit): -32.14 - Cost (constr): 9.01|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1850 of 2000 || Cost (DKL): 14.17 - Cost (fit): -34.73 - Cost (constr): 9.29|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1900 of 2000 || Cost (DKL): 14.17 - Cost (fit): -47.87 - Cost (constr): 9.29|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1950 of 2000 || Cost (DKL): 14.17 - Cost (fit): -39.30 - Cost (constr): 9.49|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 2000 of 2000 || Cost (DKL): 14.17 - Cost (fit): -50.33 - Cost (constr): 8.87|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Optimization step: 4 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 14.17 - Cost (fit): -14.46 - Cost (constr): 9.05|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 13.90 - Cost (fit): 1.00 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 13.25 - Cost (fit): -47.16 - Cost (constr): 9.75|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 13.62 - Cost (fit): -91.03 - Cost (constr): 15.04|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 14.06 - Cost (fit): -70.81 - Cost (constr): 9.05|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 14.06 - Cost (fit): -64.16 - Cost (constr): 19.53|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 14.06 - Cost (fit): -68.76 - Cost (constr): 9.06|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 14.06 - Cost (fit): -73.44 - Cost (constr): 15.47|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 14.06 - Cost (fit): -85.34 - Cost (constr): 9.88|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 14.06 - Cost (fit): -92.07 - Cost (constr): 15.71|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Propagation parameters optimization -- 
Iteration 1 of 2000 || Cost (DKL): 14.06 - Cost (fit): -53.11 - Cost (constr): 8.44|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 50 of 2000 || Cost (DKL): 14.06 - Cost (fit): -90.18 - Cost (constr): 9.30|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 100 of 2000 || Cost (DKL): 14.06 - Cost (fit): -88.41 - Cost (constr): 8.67|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 150 of 2000 || Cost (DKL): 14.06 - Cost (fit): -59.91 - Cost (constr): 9.23|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 2000 || Cost (DKL): 14.06 - Cost (fit): -86.86 - Cost (constr): 8.21|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 250 of 2000 || Cost (DKL): 14.06 - Cost (fit): -100.33 - Cost (constr): 8.82|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 300 of 2000 || Cost (DKL): 14.06 - Cost (fit): -91.39 - Cost (constr): 8.75|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 350 of 2000 || Cost (DKL): 14.06 - Cost (fit): -22.32 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 400 of 2000 || Cost (DKL): 14.06 - Cost (fit): -52.60 - Cost (constr): 9.29|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 450 of 2000 || Cost (DKL): 14.06 - Cost (fit): -27.62 - Cost (constr): 8.49|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 500 of 2000 || Cost (DKL): 14.06 - Cost (fit): -85.97 - Cost (constr): 8.26|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 550 of 2000 || Cost (DKL): 14.06 - Cost (fit): -84.15 - Cost (constr): 9.06|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 600 of 2000 || Cost (DKL): 14.06 - Cost (fit): -64.31 - Cost (constr): 8.69|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 650 of 2000 || Cost (DKL): 14.06 - Cost (fit): -16.70 - Cost (constr): 8.52|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 700 of 2000 || Cost (DKL): 14.06 - Cost (fit): -80.45 - Cost (constr): 8.87|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 750 of 2000 || Cost (DKL): 14.06 - Cost (fit): -54.94 - Cost (constr): 8.66|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 800 of 2000 || Cost (DKL): 14.06 - Cost (fit): -26.42 - Cost (constr): 8.79|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 850 of 2000 || Cost (DKL): 14.06 - Cost (fit): -91.12 - Cost (constr): 8.27|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 900 of 2000 || Cost (DKL): 14.06 - Cost (fit): -85.24 - Cost (constr): 8.70|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 950 of 2000 || Cost (DKL): 14.06 - Cost (fit): -101.99 - Cost (constr): 8.07|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1000 of 2000 || Cost (DKL): 14.06 - Cost (fit): -98.10 - Cost (constr): 8.62|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1050 of 2000 || Cost (DKL): 14.06 - Cost (fit): -94.22 - Cost (constr): 8.34|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1100 of 2000 || Cost (DKL): 14.06 - Cost (fit): -27.44 - Cost (constr): 8.96|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1150 of 2000 || Cost (DKL): 14.06 - Cost (fit): -74.95 - Cost (constr): 8.90|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1200 of 2000 || Cost (DKL): 14.06 - Cost (fit): -58.89 - Cost (constr): 7.98|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1250 of 2000 || Cost (DKL): 14.06 - Cost (fit): -104.14 - Cost (constr): 8.25|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1300 of 2000 || Cost (DKL): 14.06 - Cost (fit): -61.97 - Cost (constr): 8.91|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1350 of 2000 || Cost (DKL): 14.06 - Cost (fit): -82.79 - Cost (constr): 8.90|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1400 of 2000 || Cost (DKL): 14.06 - Cost (fit): -43.94 - Cost (constr): 8.90|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1450 of 2000 || Cost (DKL): 14.06 - Cost (fit): -78.24 - Cost (constr): 9.11|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1500 of 2000 || Cost (DKL): 14.06 - Cost (fit): -99.89 - Cost (constr): 8.97|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1550 of 2000 || Cost (DKL): 14.06 - Cost (fit): -79.31 - Cost (constr): 9.91|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1600 of 2000 || Cost (DKL): 14.06 - Cost (fit): -88.86 - Cost (constr): 8.08|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1650 of 2000 || Cost (DKL): 14.06 - Cost (fit): -48.82 - Cost (constr): 9.42|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1700 of 2000 || Cost (DKL): 14.06 - Cost (fit): -98.70 - Cost (constr): 8.19|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1750 of 2000 || Cost (DKL): 14.06 - Cost (fit): -79.09 - Cost (constr): 9.00|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1800 of 2000 || Cost (DKL): 14.06 - Cost (fit): -76.23 - Cost (constr): 8.52|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1850 of 2000 || Cost (DKL): 14.06 - Cost (fit): -84.69 - Cost (constr): 9.00|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1900 of 2000 || Cost (DKL): 14.06 - Cost (fit): -59.57 - Cost (constr): 8.28|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1950 of 2000 || Cost (DKL): 14.06 - Cost (fit): 23.51 - Cost (constr): 8.46|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 2000 of 2000 || Cost (DKL): 14.06 - Cost (fit): -91.89 - Cost (constr): 8.40|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Optimization step: 5 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 14.04 - Cost (fit): -83.53 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 13.92 - Cost (fit): -104.90 - Cost (constr): 20.13|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 14.22 - Cost (fit): -108.35 - Cost (constr): 10.12|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 15.11 - Cost (fit): -104.32 - Cost (constr): 14.90|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 15.70 - Cost (fit): -118.90 - Cost (constr): 9.01|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 15.70 - Cost (fit): -103.39 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 15.70 - Cost (fit): -135.33 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 15.70 - Cost (fit): -88.79 - Cost (constr): 9.01|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 15.70 - Cost (fit): -114.04 - Cost (constr): 9.00|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 15.70 - Cost (fit): -80.86 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Propagation parameters optimization -- 
Iteration 1 of 2000 || Cost (DKL): 15.70 - Cost (fit): -133.59 - Cost (constr): 8.12|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 50 of 2000 || Cost (DKL): 15.70 - Cost (fit): -109.00 - Cost (constr): 8.09|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 100 of 2000 || Cost (DKL): 15.70 - Cost (fit): -120.74 - Cost (constr): 8.05|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 150 of 2000 || Cost (DKL): 15.70 - Cost (fit): -133.47 - Cost (constr): 7.99|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 200 of 2000 || Cost (DKL): 15.70 - Cost (fit): -121.66 - Cost (constr): 8.15|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 250 of 2000 || Cost (DKL): 15.70 - Cost (fit): -134.63 - Cost (constr): 8.12|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 300 of 2000 || Cost (DKL): 15.70 - Cost (fit): -125.88 - Cost (constr): 7.80|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 350 of 2000 || Cost (DKL): 15.70 - Cost (fit): -110.13 - Cost (constr): 8.39|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 400 of 2000 || Cost (DKL): 15.70 - Cost (fit): -105.05 - Cost (constr): 8.21|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 450 of 2000 || Cost (DKL): 15.70 - Cost (fit): -82.62 - Cost (constr): 7.82|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 500 of 2000 || Cost (DKL): 15.70 - Cost (fit): -140.97 - Cost (constr): 7.83|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 550 of 2000 || Cost (DKL): 15.70 - Cost (fit): 14.09 - Cost (constr): 8.63|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 600 of 2000 || Cost (DKL): 15.70 - Cost (fit): -126.44 - Cost (constr): 7.85|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 650 of 2000 || Cost (DKL): 15.70 - Cost (fit): -53.14 - Cost (constr): 8.28|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 700 of 2000 || Cost (DKL): 15.70 - Cost (fit): -121.84 - Cost (constr): 7.82|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 750 of 2000 || Cost (DKL): 15.70 - Cost (fit): -135.66 - Cost (constr): 7.97|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 800 of 2000 || Cost (DKL): 15.70 - Cost (fit): -117.08 - Cost (constr): 7.77|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 850 of 2000 || Cost (DKL): 15.70 - Cost (fit): -103.65 - Cost (constr): 8.29|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 900 of 2000 || Cost (DKL): 15.70 - Cost (fit): -120.10 - Cost (constr): 7.98|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 950 of 2000 || Cost (DKL): 15.70 - Cost (fit): -124.46 - Cost (constr): 8.03|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1000 of 2000 || Cost (DKL): 15.70 - Cost (fit): -130.72 - Cost (constr): 8.29|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1050 of 2000 || Cost (DKL): 15.70 - Cost (fit): -140.00 - Cost (constr): 8.53|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1100 of 2000 || Cost (DKL): 15.70 - Cost (fit): -113.81 - Cost (constr): 7.77|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1150 of 2000 || Cost (DKL): 15.70 - Cost (fit): -128.00 - Cost (constr): 7.71|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1200 of 2000 || Cost (DKL): 15.70 - Cost (fit): -126.22 - Cost (constr): 7.76|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1250 of 2000 || Cost (DKL): 15.70 - Cost (fit): -69.09 - Cost (constr): 8.43|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1300 of 2000 || Cost (DKL): 15.70 - Cost (fit): -125.51 - Cost (constr): 7.66|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1350 of 2000 || Cost (DKL): 15.70 - Cost (fit): -130.76 - Cost (constr): 8.08|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1400 of 2000 || Cost (DKL): 15.70 - Cost (fit): -75.56 - Cost (constr): 7.98|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1450 of 2000 || Cost (DKL): 15.70 - Cost (fit): -117.27 - Cost (constr): 7.40|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1500 of 2000 || Cost (DKL): 15.70 - Cost (fit): -129.30 - Cost (constr): 8.41|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1550 of 2000 || Cost (DKL): 15.70 - Cost (fit): -127.52 - Cost (constr): 7.96|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1600 of 2000 || Cost (DKL): 15.70 - Cost (fit): -125.49 - Cost (constr): 8.52|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1650 of 2000 || Cost (DKL): 15.70 - Cost (fit): -60.54 - Cost (constr): 7.78|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1700 of 2000 || Cost (DKL): 15.70 - Cost (fit): -84.90 - Cost (constr): 8.08|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1750 of 2000 || Cost (DKL): 15.70 - Cost (fit): -110.52 - Cost (constr): 8.15|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1800 of 2000 || Cost (DKL): 15.70 - Cost (fit): -121.55 - Cost (constr): 8.14|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 1850 of 2000 || Cost (DKL): 15.70 - Cost (fit): -122.49 - Cost (constr): 8.72|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1900 of 2000 || Cost (DKL): 15.70 - Cost (fit): -60.55 - Cost (constr): 7.62|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 1950 of 2000 || Cost (DKL): 15.70 - Cost (fit): -93.52 - Cost (constr): 7.75|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Iteration 2000 of 2000 || Cost (DKL): 15.70 - Cost (fit): -141.53 - Cost (constr): 7.90|| Batch (each iter) of size 10 || Time (each iter): 0.01s
Optimization step: 6 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 15.65 - Cost (fit): -71.92 - Cost (constr): 9.02|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 16.20 - Cost (fit): -54.20 - Cost (constr): 9.17|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 17.30 - Cost (fit): -140.24 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 17.56 - Cost (fit): -91.87 - Cost (constr): 9.06|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 18.50 - Cost (fit): -164.45 - Cost (constr): 9.02|| Batch (each iter) of size 10 || Time (each iter): 0.02s
 -- Time reparameterization --
Iteration 1 of 200 || Cost (DKL): 18.50 - Cost (fit): -115.53 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 18.50 - Cost (fit): -104.63 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 18.50 - Cost (fit): -160.81 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 18.50 - Cost (fit): -167.23 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 18.50 - Cost (fit): -113.86 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Optimization step: 6 out of 6
 -- Regression --
Iteration 1 of 200 || Cost (DKL): 18.47 - Cost (fit): -159.05 - Cost (constr): 9.06|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 50 of 200 || Cost (DKL): 19.22 - Cost (fit): -155.02 - Cost (constr): 9.47|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 100 of 200 || Cost (DKL): 21.01 - Cost (fit): -124.63 - Cost (constr): 9.15|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 150 of 200 || Cost (DKL): 22.81 - Cost (fit): -128.64 - Cost (constr): 9.05|| Batch (each iter) of size 10 || Time (each iter): 0.02s
Iteration 200 of 200 || Cost (DKL): 23.23 - Cost (fit): -157.34 - Cost (constr): 8.99|| Batch (each iter) of size 10 || Time (each iter): 0.02s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Let&#39;s now plot some results</span>

<span class="c1">## Here we plot the estimated GPs</span>
<span class="n">model</span><span class="o">.</span><span class="n">Plot_GPs</span><span class="p">(</span><span class="n">subject</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">just_subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># and compare with the simulated data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>


<span class="c1">## Plot the estimated propagation parameters and compare with ground truth values</span>
<span class="n">model</span><span class="o">.</span><span class="n">Plot_kij</span><span class="p">(</span><span class="n">save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">synthetic</span> <span class="o">=</span> <span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9c9f99b4fb6d831a98e516522fb11f4d95a47056e8b5ed9fcc198727612b83e7.png" src="../../../_images/9c9f99b4fb6d831a98e516522fb11f4d95a47056e8b5ed9fcc198727612b83e7.png" />
<img alt="../../../_images/fb56d62c7c529a5deea77c56689d915e94dc49c26bc517b00846ba8f48f1264b.png" src="../../../_images/fb56d62c7c529a5deea77c56689d915e94dc49c26bc517b00846ba8f48f1264b.png" />
<img alt="../../../_images/4dc798ac44c7ef198523a7f65a2cb2b0f16e2f491b55392d8fbe027ee58bcaf0.png" src="../../../_images/4dc798ac44c7ef198523a7f65a2cb2b0f16e2f491b55392d8fbe027ee58bcaf0.png" />
<img alt="../../../_images/afc3a08458d77292de7628662452f8656c062aaa1530a0578ae6a907e8813713.png" src="../../../_images/afc3a08458d77292de7628662452f8656c062aaa1530a0578ae6a907e8813713.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7, 8, 9, 10, 11, 12, 13, 14]
[0, 1, 2, 3, 4, 5, 6, 7]
[5, 6, 7, 8, 9, 10, 11, 12]
</pre></div>
</div>
<img alt="../../../_images/540e863abd17d6c3d99440e6aba57d955c981258072e45dac8acdd84eb051a17.png" src="../../../_images/540e863abd17d6c3d99440e6aba57d955c981258072e45dac8acdd84eb051a17.png" />
<img alt="../../../_images/2e81d73f23fc9f72908686bdb9a82085b681db58baa75a7eaad8eb02e5dd069a.png" src="../../../_images/2e81d73f23fc9f72908686bdb9a82085b681db58baa75a7eaad8eb02e5dd069a.png" />
</div>
</div>
</div>
<div class="section" id="part-iv-application-to-amyloid-spread-on-adni-data">
<h2>Part IV: application to amyloid spread on ADNI data<a class="headerlink" href="#part-iv-application-to-amyloid-spread-on-adni-data" title="Permalink to this heading">#</a></h2>
<p>Of course we can do way more, plot-wise!</p>
<p>Let’s have a look at it, but on real ADNI /amyloid data, so that we can gather some biological insights.</p>
<p>Specifically:</p>
<ul class="simple">
<li><p>we use the <strong>ACP</strong> model (which is the most complete, accounts for the processes of accumulation, clearance, propagation etc);</p></li>
<li><p>the substrate along which propagation occurs is the <strong>structural connectome</strong> derived from diffusion MRI data;</p></li>
<li><p>we analyze <strong>AV45–PET</strong> brain imaging data of 770 subjects from <strong>ADNI</strong>, with a total of 1477 longitudinal data points.</p></li>
</ul>
<div class="section" id="the-data">
<h3>The data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h3>
<p>The model is pre-trained so now we play on data visualisation.</p>
<p>Quick info on the data we used
<img alt="Table" src="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/_static/img/gppm/notebook-figs/table.png?raw=true" /></p>
</div>
</div>
<div class="section" id="set-up">
<h2>Set up<a class="headerlink" href="#set-up" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">GP_progression_model</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">platform</span> <span class="k">as</span> <span class="n">sys_pf</span>
<span class="kn">from</span> <span class="nn">GP_progression_model</span> <span class="kn">import</span> <span class="n">DataGenerator</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="k">if</span> <span class="n">sys_pf</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;TkAgg&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">colorConverter</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">genfromtxt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../../&#39;</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">fastest</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load pre-trained data</span>

<span class="n">dat</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/sgarbarino/DPM-website-tutorial/blob/main/ADNI_processed.dat&#39;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data.dat&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualisation">
<h2>Visualisation<a class="headerlink" href="#visualisation" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot estimated biomarker trajectories together with subjects, which have been shifted according to the time reparametrization </span>
<span class="n">model</span><span class="o">.</span><span class="n">Plot_GPs</span><span class="p">(</span><span class="n">subject</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f0547d55cf576b8ff6120ddc5d6574623197a9af3f1b7cb666c11d9c063817e0.png" src="../../../_images/f0547d55cf576b8ff6120ddc5d6574623197a9af3f1b7cb666c11d9c063817e0.png" />
<img alt="../../../_images/c3d5e815a01957ecf7b658db566f869adf09309e3330145fb2d4cb85fe9ab852.png" src="../../../_images/c3d5e815a01957ecf7b658db566f869adf09309e3330145fb2d4cb85fe9ab852.png" />
<img alt="../../../_images/87b765ad55fc9c568912a440a59514ad0c995ab766ba1397527dbf06d7ac6336.png" src="../../../_images/87b765ad55fc9c568912a440a59514ad0c995ab766ba1397527dbf06d7ac6336.png" />
<img alt="../../../_images/07d9501ee39cc050c214f960a617ba94d3b9c426f0ac153f28b4c79de4d2a1ef.png" src="../../../_images/07d9501ee39cc050c214f960a617ba94d3b9c426f0ac153f28b4c79de4d2a1ef.png" />
<img alt="../../../_images/00d8c5bbe4d50224c91b78d9d143cfcf310d9a61cfa48c6a1b6e55418639ccd7.png" src="../../../_images/00d8c5bbe4d50224c91b78d9d143cfcf310d9a61cfa48c6a1b6e55418639ccd7.png" />
<img alt="../../../_images/3257737d335e33768c12ec6b48c12b8aca5844ceed7d79424e02017b1bce62bd.png" src="../../../_images/3257737d335e33768c12ec6b48c12b8aca5844ceed7d79424e02017b1bce62bd.png" />
<img alt="../../../_images/a93b25f1fe2bd2b66f8ee2fc87179f24b919e96a48cdb614971d974accde984d.png" src="../../../_images/a93b25f1fe2bd2b66f8ee2fc87179f24b919e96a48cdb614971d974accde984d.png" />
<img alt="../../../_images/68df07767e00695d19f48818bcc460e25adcac5cf8452cf13be2a93b09975699.png" src="../../../_images/68df07767e00695d19f48818bcc460e25adcac5cf8452cf13be2a93b09975699.png" />
<img alt="../../../_images/37a219f17ac480e9d909e42ae20bce901377301603d4630010980088077b046d.png" src="../../../_images/37a219f17ac480e9d909e42ae20bce901377301603d4630010980088077b046d.png" />
<img alt="../../../_images/bdb02de9232e5e26d060368dcf6b1772719986a064e1154f170055316c7c1d84.png" src="../../../_images/bdb02de9232e5e26d060368dcf6b1772719986a064e1154f170055316c7c1d84.png" />
<img alt="../../../_images/a20cc70eb2143c2c226a42f111cf5962eb8fe1081a64808f705afa22977477c3.png" src="../../../_images/a20cc70eb2143c2c226a42f111cf5962eb8fe1081a64808f705afa22977477c3.png" />
<img alt="../../../_images/113fbd64eac70dc6b599c47afb5111ae274ab2c8aae8b741df083f338904678a.png" src="../../../_images/113fbd64eac70dc6b599c47afb5111ae274ab2c8aae8b741df083f338904678a.png" />
<img alt="../../../_images/91420ed01333e2777302dc84acb343a017a7be450f6b771db51fe2348c17fee7.png" src="../../../_images/91420ed01333e2777302dc84acb343a017a7be450f6b771db51fe2348c17fee7.png" />
<img alt="../../../_images/d82548d35a680fbe6ccd6b2df9842d997833c1f01d3abf291017ee9357325bac.png" src="../../../_images/d82548d35a680fbe6ccd6b2df9842d997833c1f01d3abf291017ee9357325bac.png" />
<img alt="../../../_images/12e43140848fcd03a072205a21c62d0835c9d3aeabf8325bb9ed239960d2056b.png" src="../../../_images/12e43140848fcd03a072205a21c62d0835c9d3aeabf8325bb9ed239960d2056b.png" />
<img alt="../../../_images/dc642d62af2362432d1d8f8b1fffb6ea9d9040b0df808159406caf31c7523424.png" src="../../../_images/dc642d62af2362432d1d8f8b1fffb6ea9d9040b0df808159406caf31c7523424.png" />
<img alt="../../../_images/3670a6e6244b1638341ae4d5ad59998091b0a0555f7e4098d5243cdab9e74b95.png" src="../../../_images/3670a6e6244b1638341ae4d5ad59998091b0a0555f7e4098d5243cdab9e74b95.png" />
<img alt="../../../_images/0c40b09453928dde243c1313ff7b6ce729c6c452b4097d1ce83fff8a96ccaf3a.png" src="../../../_images/0c40b09453928dde243c1313ff7b6ce729c6c452b4097d1ce83fff8a96ccaf3a.png" />
<img alt="../../../_images/dee9531f5d2e8f889a7eaf046c631d230d41647b39b3bb9c280066a6a954a1a3.png" src="../../../_images/dee9531f5d2e8f889a7eaf046c631d230d41647b39b3bb9c280066a6a954a1a3.png" />
<img alt="../../../_images/af4db8f34b403f8b62338b4e4013944efebbf0b1af311531749079502073a787.png" src="../../../_images/af4db8f34b403f8b62338b4e4013944efebbf0b1af311531749079502073a787.png" />
<img alt="../../../_images/42a526d6b37aca955544095167064c85d5b42fa18cf43a7c621301b13555a903.png" src="../../../_images/42a526d6b37aca955544095167064c85d5b42fa18cf43a7c621301b13555a903.png" />
<img alt="../../../_images/fc07f2dbb9139ee3ac60b14860553b182ccb654df1346137714bd905c1114971.png" src="../../../_images/fc07f2dbb9139ee3ac60b14860553b182ccb654df1346137714bd905c1114971.png" />
<img alt="../../../_images/b6cf95260263e12223440b748d66ab86ec5943dd9fc6b2833ce8a71600af05eb.png" src="../../../_images/b6cf95260263e12223440b748d66ab86ec5943dd9fc6b2833ce8a71600af05eb.png" />
<img alt="../../../_images/f6f92d53144e3ebd175d77c12bc8c349a39f04311d24140e329cff4697f52b8b.png" src="../../../_images/f6f92d53144e3ebd175d77c12bc8c349a39f04311d24140e329cff4697f52b8b.png" />
<img alt="../../../_images/ef51084dffb22ee60f30e93ee4cf01bf0a05407cd845669330a163d02d9b91b8.png" src="../../../_images/ef51084dffb22ee60f30e93ee4cf01bf0a05407cd845669330a163d02d9b91b8.png" />
<img alt="../../../_images/ebc37f54f3448aa0a50d9b618ed218300cc8b0346771d7692ba2ed7e6720afea.png" src="../../../_images/ebc37f54f3448aa0a50d9b618ed218300cc8b0346771d7692ba2ed7e6720afea.png" />
<img alt="../../../_images/86d3e2edc2a628ebf592ce4959351fe34c6fa954a0167c6235b1150da3a2798c.png" src="../../../_images/86d3e2edc2a628ebf592ce4959351fe34c6fa954a0167c6235b1150da3a2798c.png" />
<img alt="../../../_images/cbf5efcea86a0d6faba1dcb592075b91efff75b35b2897e622f7a58ded1e77d5.png" src="../../../_images/cbf5efcea86a0d6faba1dcb592075b91efff75b35b2897e622f7a58ded1e77d5.png" />
<img alt="../../../_images/4296d8251bf254681de000a08f22ceea1792ad17b01a6e52172d41374484b67a.png" src="../../../_images/4296d8251bf254681de000a08f22ceea1792ad17b01a6e52172d41374484b67a.png" />
<img alt="../../../_images/737442f628ba18a89f1e950debe99b6b5c5da8a86515e10aff2a8cd00d957f9d.png" src="../../../_images/737442f628ba18a89f1e950debe99b6b5c5da8a86515e10aff2a8cd00d957f9d.png" />
<img alt="../../../_images/32bf739b9d72e51770047f0f83e511b744338634c268988ddc3ae8f5f58fdbc0.png" src="../../../_images/32bf739b9d72e51770047f0f83e511b744338634c268988ddc3ae8f5f58fdbc0.png" />
<img alt="../../../_images/5f2ca6cbcee33b6b7c99c1707f63fa269ac05ca2a42618ce666698f522bade1c.png" src="../../../_images/5f2ca6cbcee33b6b7c99c1707f63fa269ac05ca2a42618ce666698f522bade1c.png" />
<img alt="../../../_images/90b9661d165c5732b27be123535bd3b13e6c6decf2a830f0020c10dbd097be3d.png" src="../../../_images/90b9661d165c5732b27be123535bd3b13e6c6decf2a830f0020c10dbd097be3d.png" />
<img alt="../../../_images/60750c090622de8a7779c6237e13fd9d59631e61005c5f30bea795a4b261b8f6.png" src="../../../_images/60750c090622de8a7779c6237e13fd9d59631e61005c5f30bea795a4b261b8f6.png" />
<img alt="../../../_images/42432cf432edff1b2fbda07b5d0e4faa3d1bcdcf8c8a96d1b23e33b11b64a031.png" src="../../../_images/42432cf432edff1b2fbda07b5d0e4faa3d1bcdcf8c8a96d1b23e33b11b64a031.png" />
<img alt="../../../_images/56c85b607b6c6c6d452209e388964f4bbd64bd25f1ba294ea4c2988cfadeaaf9.png" src="../../../_images/56c85b607b6c6c6d452209e388964f4bbd64bd25f1ba294ea4c2988cfadeaaf9.png" />
<img alt="../../../_images/73c5da861ff00795a0085a158bae5a65afd0d88d76eae5a24960af1217a8a242.png" src="../../../_images/73c5da861ff00795a0085a158bae5a65afd0d88d76eae5a24960af1217a8a242.png" />
<img alt="../../../_images/e3b88b22278b7bb811efcda60a0956b9d563530a83da3f72e1c7dd86648fa656.png" src="../../../_images/e3b88b22278b7bb811efcda60a0956b9d563530a83da3f72e1c7dd86648fa656.png" />
<img alt="../../../_images/2672b6213b21c2ad3b706ca924dd5d64ea18313f0221eb581eeee1aa3794238d.png" src="../../../_images/2672b6213b21c2ad3b706ca924dd5d64ea18313f0221eb581eeee1aa3794238d.png" />
<img alt="../../../_images/7a9d4901285aab61eb274b1768f4fb923f556bb2917082f5f21e159ad6f74edf.png" src="../../../_images/7a9d4901285aab61eb274b1768f4fb923f556bb2917082f5f21e159ad6f74edf.png" />
<img alt="../../../_images/a563397e945f50207e8abf50f6809045e62769d0e78c0df5bab4e222b7172b00.png" src="../../../_images/a563397e945f50207e8abf50f6809045e62769d0e78c0df5bab4e222b7172b00.png" />
<img alt="../../../_images/3b96fbc28f3bc1c28a5ee317f13f780572e895d8690e0e5cf3041afb687f2551.png" src="../../../_images/3b96fbc28f3bc1c28a5ee317f13f780572e895d8690e0e5cf3041afb687f2551.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot diagnostic separation of subjects according to time-shift</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Return_time_parameters</span><span class="p">()</span>
<span class="n">list_biomarker</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span> <span class="s2">&quot;vals&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">})</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">vals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">group_name</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4f6d33b033535a63fc565febd1bd874521f232bfeb61181a1a71b91acc837cad.png" src="../../../_images/4f6d33b033535a63fc565febd1bd874521f232bfeb61181a1a71b91acc837cad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Visualise propagation parameters along the connections over time, on three specific regions of interest</span>
<span class="n">x_range</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">x_mean_std</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="n">mean_norm</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
<span class="n">kij</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>

<span class="n">idx_biom_selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="c1"># ---&gt; Lingual, precuneus, supramarginal</span>

<span class="c1">### We have two ways of visualising:</span>

<span class="c1">#### A) Along the associated anatomical connections</span>
<span class="c1">#### B) Overlaid on the binary adjacency matrix of the connectome (nilearn is needed)</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>nilearn
<span class="n">GP_progression_model</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">idx_biom_selected</span><span class="p">,</span> <span class="n">list_biomarker</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">connectome</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">mean_norm</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting nilearn
?25l  Downloading https://files.pythonhosted.org/packages/4a/bd/2ad86e2c00ecfe33b86f9f1f6d81de8e11724e822cdf1f5b2d0c21b787f1/nilearn-0.7.1-py3-none-any.whl (3.0MB)
     |████████████████████████████████| 3.1MB 8.3MB/s 
?25hRequirement already satisfied: nibabel&gt;=2.0.2 in /usr/local/lib/python3.7/dist-packages (from nilearn) (3.0.2)
Requirement already satisfied: joblib&gt;=0.12 in /usr/local/lib/python3.7/dist-packages (from nilearn) (1.0.1)
Requirement already satisfied: pandas&gt;=0.18.0 in /usr/local/lib/python3.7/dist-packages (from nilearn) (1.1.5)
Requirement already satisfied: numpy&gt;=1.11 in /usr/local/lib/python3.7/dist-packages (from nilearn) (1.19.5)
Requirement already satisfied: requests&gt;=2 in /usr/local/lib/python3.7/dist-packages (from nilearn) (2.23.0)
Requirement already satisfied: scikit-learn&gt;=0.19 in /usr/local/lib/python3.7/dist-packages (from nilearn) (0.22.2.post1)
Requirement already satisfied: scipy&gt;=0.19 in /usr/local/lib/python3.7/dist-packages (from nilearn) (1.4.1)
Requirement already satisfied: pytz&gt;=2017.2 in /usr/local/lib/python3.7/dist-packages (from pandas&gt;=0.18.0-&gt;nilearn) (2018.9)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas&gt;=0.18.0-&gt;nilearn) (2.8.1)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests&gt;=2-&gt;nilearn) (1.24.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests&gt;=2-&gt;nilearn) (2020.12.5)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.7/dist-packages (from requests&gt;=2-&gt;nilearn) (2.10)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests&gt;=2-&gt;nilearn) (3.0.4)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.7.3-&gt;pandas&gt;=0.18.0-&gt;nilearn) (1.15.0)
Installing collected packages: nilearn
Successfully installed nilearn-0.7.1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>We have generated A) and B) (look at the Files folder on the left tab here).</p>
<p>From there we can easily generate animated videos!</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-center head"><p>trajectories of the three regions</p></th>
<th class="text-center head"><p>propagation along the connections</p></th>
<th class="text-center head"><p>propagation along the connectomne</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="GPs" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/GPs.gif?raw=true" /></p></td>
<td class="text-center"><p><img alt="kijs" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/kijs.gif?raw=true" /></p></td>
<td class="text-center"><p><img alt="connectome" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/connectome.gif?raw=true" /></p></td>
</tr>
</tbody>
</table>
<div class="section" id="personalisation-of-disease-dynamics">
<h3>Personalisation of disease dynamics<a class="headerlink" href="#personalisation-of-disease-dynamics" title="Permalink to this heading">#</a></h3>
<p>For each subject, the DS structure of of framework allows to integrate the dynamics over time given an initial condition, obtaining a vector field governing forward and backward evolution in time associated with the individuals.</p>
<div class="section" id="we-can-derive-two-animated-plots">
<h4>We can derive two animated plots:<a class="headerlink" href="#we-can-derive-two-animated-plots" title="Permalink to this heading">#</a></h4>
<p>A) Streamlines for the estimated amyloid deposition dynamics</p>
<p>B) Predicted cumulative amyloid deposition on the brain</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## As didactic purpose we just generate example vector field plot</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Return_ODE_parameters</span><span class="p">()</span>

<span class="n">sub</span> <span class="o">=</span> <span class="mi">93</span> <span class="c1"># select a specific subject (this is MCI converted to AD within our time-frame)</span>

<span class="n">region1</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># select two regions of interest: here precuneus and lingual</span>
<span class="n">region2</span> <span class="o">=</span> <span class="mi">13</span>

<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">region1</span><span class="p">,</span> <span class="n">region2</span><span class="p">])</span>
<span class="n">idx_compl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setxor1d</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_biomarker</span><span class="p">)),</span> <span class="n">idx</span><span class="p">)</span>

<span class="n">x0_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">sub</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_biomarker</span><span class="p">))])</span> <span class="c1"># subject-specific baseline values</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_range</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x_mean_std</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">x_mean_std</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="c1"># subject-specific time frame</span>

<span class="n">GP_progression_model</span><span class="o">.</span><span class="n">plot_vector_field</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">list_biomarker</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">x0_full</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">100</span><span class="p">,</span> <span class="n">x0_full</span><span class="p">[</span><span class="n">idx_compl</span><span class="p">],</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span>
                                       <span class="n">xran</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0_full</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">x0_full</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">.1</span><span class="p">],</span> 
                                       <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="s1">&#39;streamline&#39;</span><span class="p">,</span> <span class="n">propagation_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">propagation_model</span><span class="p">,</span>
                                       <span class="n">subject</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/26feafcb500f5d0d8383a5bdc9c1e3f693de0aadd8e5464b1f40dadcac17023c.png" src="../../../_images/26feafcb500f5d0d8383a5bdc9c1e3f693de0aadd8e5464b1f40dadcac17023c.png" />
</div>
</div>
<p>These plots require more sophisticated tools (e.g. Brain images for B) obtained with BrainPainter - available at brainpainter.csail.mit.edu/) - see you at a next tutorial session for learning about it :)</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-center head"><p>Streamlines for the estimated amyloid deposition dynamics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="VFs" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/VFs.gif?raw=true" /></p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-center head"><p>Predicted cumulative amyloid deposition (cortical)</p></th>
<th class="text-center head"><p>Predicted cumulative amyloid deposition (cortical)</p></th>
<th class="text-center head"><p>Predicted cumulative amyloid deposition (subcortical)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="outer" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/93_cortical_outer.gif?raw=true" /></p></td>
<td class="text-center"><p><img alt="inner" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/93_cortical_inner.gif?raw=true" /></p></td>
<td class="text-center"><p><img alt="sub" src="https://github.com/sgarbarino/DPM-website-tutorial/blob/main/images/93_subcortical.gif?raw=true" /></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pages/notebooks/non_parametric_DPM"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="GPPM_basic.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">GPPM for disease progression modeling: basic use</p>
      </div>
    </a>
    <a class="right-next"
       href="../sustain/sustain.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Disease Course Sequencing and Phenotyping with the Subtype and Stage Inference Model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives :</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-i-introducing-the-framework">Part I: introducing the framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gppm-basic">GPPM-basic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gppm-ds">GPPM-DS</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example">An example</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#formally">Formally…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-ii-experimenting-with-different-dynamical-systems">Part II: experimenting with different dynamical systems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diffusion-data-with-different-connections-between-biomarkers">Diffusion data with different connections between biomarkers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-number-of-markers-propagation-parameters-etc">Changing number of markers, propagation parameters, etc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-the-dynamical-system">Changing the dynamical system</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iii-run-the-optimizer">Part III: run the optimizer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iv-application-to-amyloid-spread-on-adni-data">Part IV: application to amyloid spread on ADNI data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisation">Visualisation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#personalisation-of-disease-dynamics">Personalisation of disease dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-derive-two-animated-plots">We can derive two animated plots:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Disease Progression Modelling community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>